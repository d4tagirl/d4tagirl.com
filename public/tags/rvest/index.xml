<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>rvest on d4tagirl</title>
    <link>/tags/rvest/</link>
    <description>Recent content in rvest on d4tagirl</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Tue, 03 Apr 2018 17:11:29 +0000</lastBuildDate>
    
        <atom:link href="/tags/rvest/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Scrapeando las Sesiones Parlamentarias de Uruguay</title>
      <link>/2018/04/scrapeando-las-sesiones-parlamentarias-de-uruguay/</link>
      <pubDate>Tue, 03 Apr 2018 17:11:29 +0000</pubDate>
      
      <guid>/2018/04/scrapeando-las-sesiones-parlamentarias-de-uruguay/</guid>
      <description>

&lt;p&gt;En Uruguay venimos avanzando con las iniciativas de datos abiertos, pero a칰n queda mucho camino por recorrer. Algunas de las dificultades para analizar datos abiertos son:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Que no siempre no es f치cil acceder a ellos de forma sistem치tica:
por ejemplo porque no est치n todos juntos en un archivo comprimido para descargarlos, o no existe una API para acceder a la informaci칩n,&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Que est치n en formato pdf del que no es tan f치cil extraer informaci칩n como de un archivo txt o csv, por nombrar algunos formatos.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;En particular hay dos problemas que quiero resolver:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Descargar los archivos en formato pdf de las Sesiones Parlamentarias de Diputados y Senadores de forma sistem치tica, haciendo &lt;a href=&#34;https://es.wikipedia.org/wiki/Web_scraping&#34;&gt;lo que se conoce como &lt;em&gt;web scraping&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Extraer el texto contenido en los archivos en formato pdf.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;En este art칤culo muestro c칩mo se pueden sortear ambas dificultades, usando los paquetes &lt;a href=&#34;https://github.com/tidyverse/rvest&#34;&gt;rvest&lt;/a&gt; para explorar la web y descargar los Diarios de Sesiones, y &lt;a href=&#34;https://github.com/ropensci/pdftools&#34;&gt;pdftools&lt;/a&gt; para extraer el contenido de los archivos en formato pdf.&lt;/p&gt;

&lt;h1 id=&#34;est치-permitido-que-un-robot-se-comunique-con-estas-p치ginas&#34;&gt;Est치 permitido que un robot se comunique con estas p치ginas?&lt;/h1&gt;

&lt;p&gt;Si bien se trata de datos abiertos, hay ciertas normas &lt;em&gt;de etiqueta&lt;/em&gt; que es recomendable seguir. Respetar las reglas que establecieron los que administran el sitio acerca de c칩mo quieren que la gente lo use es una de ellas. Puede ser que s칩lo quieran que se navegue &lt;em&gt;a mano&lt;/em&gt;, entonces no deber칤a intentar acceder de la forma en que estoy planeando.&lt;/p&gt;

&lt;p&gt;Para ver si la secci칩n del sitio web que quiero navegar permite ser accedida por un &lt;em&gt;robot&lt;/em&gt; (que es lo que pretendo construir! 游뱄), examino &lt;a href=&#34;https://en.wikipedia.org/wiki/Robots_exclusion_standard&#34;&gt;el archivo &lt;em&gt;robots.txt&lt;/em&gt;&lt;/a&gt;, donde se establece para cada secci칩n del sitio si este uso es adecuado. Desde R se puede hacer f치cilmente usando &lt;a href=&#34;https://github.com/ropensci/robotstxt&#34;&gt;el parquete robotstxt&lt;/a&gt; de &lt;a href=&#34;https://ropensci.org/&#34;&gt;rOpenSci&lt;/a&gt;, que &lt;a href=&#34;https://masalmon.eu/2017/10/02/guardian-experience/&#34;&gt;Ma칢lle mencion칩 en su post donde scrapea datos de &lt;em&gt;The Guardian&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Este es todo el archivo &lt;em&gt;robots.txt&lt;/em&gt; del &lt;a href=&#34;https://parlamento.gub.uy&#34;&gt;sitio web del Parlamento&lt;/a&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;robotstxt::get_robotstxt(&amp;quot;https://parlamento.gub.uy&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## #
## # robots.txt
## #
## # This file is to prevent the crawling and indexing of certain parts
## # of your site by web crawlers and spiders run by sites like Yahoo!
## # and Google. By telling these &amp;quot;robots&amp;quot; where not to go on your site,
## # you save bandwidth and server resources.
## #
## # This file will be ignored unless it is at the root of your host:
## # Used:    http://example.com/robots.txt
## # Ignored: http://example.com/site/robots.txt
## #
## # For more information about the robots.txt standard, see:
## # http://www.robotstxt.org/robotstxt.html
## 
## User-agent: *
## Crawl-delay: 10
## # CSS, JS, Images
## Allow: /misc/*.css$
## Allow: /misc/*.css?
## Allow: /misc/*.js$
## Allow: /misc/*.js?
## Allow: /misc/*.gif
## Allow: /misc/*.jpg
## Allow: /misc/*.jpeg
## Allow: /misc/*.png
## Allow: /modules/*.css$
## Allow: /modules/*.css?
## Allow: /modules/*.js$
## Allow: /modules/*.js?
## Allow: /modules/*.gif
## Allow: /modules/*.jpg
## Allow: /modules/*.jpeg
## Allow: /modules/*.png
## Allow: /profiles/*.css$
## Allow: /profiles/*.css?
## Allow: /profiles/*.js$
## Allow: /profiles/*.js?
## Allow: /profiles/*.gif
## Allow: /profiles/*.jpg
## Allow: /profiles/*.jpeg
## Allow: /profiles/*.png
## Allow: /themes/*.css$
## Allow: /themes/*.css?
## Allow: /themes/*.js$
## Allow: /themes/*.js?
## Allow: /themes/*.gif
## Allow: /themes/*.jpg
## Allow: /themes/*.jpeg
## Allow: /themes/*.png
## # Directories
## Disallow: /includes/
## Disallow: /misc/
## Disallow: /modules/
## Disallow: /profiles/
## Disallow: /scripts/
## Disallow: /themes/
## # Files
## Disallow: /CHANGELOG.txt
## Disallow: /cron.php
## Disallow: /INSTALL.mysql.txt
## Disallow: /INSTALL.pgsql.txt
## Disallow: /INSTALL.sqlite.txt
## Disallow: /install.php
## Disallow: /INSTALL.txt
## Disallow: /LICENSE.txt
## Disallow: /MAINTAINERS.txt
## Disallow: /update.php
## Disallow: /UPGRADE.txt
## Disallow: /xmlrpc.php
## # Paths (clean URLs)
## Disallow: /admin/
## Disallow: /comment/reply/
## Disallow: /filter/tips/
## Disallow: /node/add/
## Disallow: /search/
## Disallow: /user/register/
## Disallow: /user/password/
## Disallow: /user/login/
## Disallow: /user/logout/
## # Paths (no clean URLs)
## Disallow: /?q=admin/
## Disallow: /?q=comment/reply/
## Disallow: /?q=filter/tips/
## Disallow: /?q=node/add/
## Disallow: /?q=search/
## Disallow: /?q=user/password/
## Disallow: /?q=user/register/
## Disallow: /?q=user/login/
## Disallow: /?q=user/logout/
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/a/40186203/7248543&#34;&gt;Lo que no aparece como &lt;em&gt;&amp;ldquo;Disallow&amp;rdquo;&lt;/em&gt; es permitido por defecto&lt;/a&gt;, y la url a la que quiero acceder usando un robot es &lt;a href=&#34;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion&#34;&gt;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion&lt;/a&gt;. No dice en ning칰n lugar del documento &lt;code&gt;Disallow: /documentosyleyes/&lt;/code&gt;, entonces est치 permitido!&lt;/p&gt;

&lt;p&gt;Pero por las dudas, chequeo esa url en particular:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;robotstxt::paths_allowed(&amp;quot;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## [1] TRUE
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Tengo luz verde para scrapear la web 游뗿.&lt;/p&gt;

&lt;h1 id=&#34;url-de-las-p치ginas-que-quiero-scrapear&#34;&gt;Url de las p치ginas que quiero &lt;em&gt;scrapear&lt;/em&gt;&lt;/h1&gt;

&lt;p&gt;Mi intenci칩n es descargar las sesiones de Diputados y Senadores desde el 1췈/1/2017 hasta el 31/3/2018. Al incorporar estos filtros manualmente en la p치gina &lt;a href=&#34;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion&#34;&gt;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion&lt;/a&gt;, la url se va modificando para incorporar esta informaci칩n. Eso hace las cosas algo menos complicadas para mi, porque una vez que me doy cuenta c칩mo se comporta la url con esos filtros, puedo generar la url nueva y directamente acceder a ella. As칤 construyo la nueva url que se compone de la url original, algo de texto adicional y los filtros de fechas, de la siguiente forma:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;date_init &amp;lt;- &amp;quot;01-01-2017&amp;quot;
date_end  &amp;lt;- &amp;quot;31-03-2018&amp;quot;

url_diputados &amp;lt;- paste0(&amp;quot;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion?Cpo_Codigo_2=D&amp;amp;Lgl_Nro=48&amp;amp;DS_Fecha%5Bmin%5D%5Bdate%5D=&amp;quot;,
                        date_init,
                        &amp;quot;&amp;amp;DS_Fecha%5Bmax%5D%5Bdate%5D=&amp;quot;,
                        date_end,
                        &amp;quot;&amp;amp;Ssn_Nro=&amp;amp;TS_Diario=&amp;amp;tipoBusqueda=T&amp;amp;Texto=&amp;quot;)
url_diputados
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion?Cpo_Codigo_2=D&amp;amp;Lgl_Nro=48&amp;amp;DS_Fecha%5Bmin%5D%5Bdate%5D=01-01-2017&amp;amp;DS_Fecha%5Bmax%5D%5Bdate%5D=31-03-2018&amp;amp;Ssn_Nro=&amp;amp;TS_Diario=&amp;amp;tipoBusqueda=T&amp;amp;Texto=&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;url_senadores &amp;lt;- paste0(&amp;quot;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion?Cpo_Codigo_2=S&amp;amp;Lgl_Nro=48&amp;amp;DS_Fecha%5Bmin%5D%5Bdate%5D=&amp;quot;,
                        date_init,
                        &amp;quot;&amp;amp;DS_Fecha%5Bmax%5D%5Bdate%5D=&amp;quot;,
                        date_end,
                        &amp;quot;&amp;amp;Ssn_Nro=&amp;amp;TS_Diario=&amp;amp;tipoBusqueda=T&amp;amp;Texto=&amp;quot;)

url_senadores
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion?Cpo_Codigo_2=S&amp;amp;Lgl_Nro=48&amp;amp;DS_Fecha%5Bmin%5D%5Bdate%5D=01-01-2017&amp;amp;DS_Fecha%5Bmax%5D%5Bdate%5D=31-03-2018&amp;amp;Ssn_Nro=&amp;amp;TS_Diario=&amp;amp;tipoBusqueda=T&amp;amp;Texto=&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;y-ahora-c칩mo-selecciono-el-contenido-de-la-p치gina&#34;&gt;Y ahora? C칩mo selecciono el contenido de la p치gina?&lt;/h1&gt;

&lt;p&gt;Las p치ginas web son archivos html que el navegador interpreta y los transforma en lo que nosotros vemos. No voy a entrar en muchos detalles de c칩mo interpretar un archivo html (porque reci칠n estoy aprendiendo!), pero ac치 describo la  forma m치s intuitiva que encontr칠 para seleccionar el contenido del html al que quiero acceder.&lt;/p&gt;

&lt;p&gt;Como se muestra en la animaci칩n a continuaci칩n, usando el &lt;a href=&#34;https://selectorgadget.com/&#34;&gt;Selector Gadget&lt;/a&gt; (que tiene una extensi칩n para Google Chrome muy conveniente) me paro con el mouse sobre uno de los links a los pdfs y hago click. Ah칤 queda pintada toda la columna, porque pinta todos los elementos que son de la misma &lt;em&gt;clase&lt;/em&gt; (no nos preocupemos de qu칠 es una &lt;em&gt;clase&lt;/em&gt; ahora). Lo importante es que necesito &lt;em&gt;el nombre de la clase&lt;/em&gt; para lo que viene a continuaci칩n, entonces copio el texto que aparece en el recuadro (en este caso es &lt;code&gt;.views-field-DS-File-IMG&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/post/scrapeando-las-sesiones-parlamentarias-de-uruguay/2018-04-03-scrapeando-las-sesiones-parlamentarias-de-uruguay/selector_gadget.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h1 id=&#34;web-scraping&#34;&gt;Web scraping!&lt;/h1&gt;

&lt;h2 id=&#34;extraigo-los-pdfs&#34;&gt;Extraigo los pdfs&lt;/h2&gt;

&lt;p&gt;Ahora es que empiezo a usar el paquete &lt;a href=&#34;https://github.com/tidyverse/rvest&#34;&gt;rvest&lt;/a&gt;. Defino una funci칩n que descarga los pdfs y los guarda en un dataframe, haciendo algunas transformaciones. Para explicar lo que hace la funci칩n voy a ignorar que como las sesiones son muchas, las muestra en dos p치ginas separadas. Es verdad que podr칤a haber puesto un poco m치s de esfuerzo en hacer esta funci칩n generalizable a &lt;em&gt;n&lt;/em&gt; p치ginas, pero como sab칤a que ten칤a s칩lo 2, lo dej칠 as칤 游땒&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(dplyr)
library(rvest)
library(purrr)
library(tibble)
library(pdftools)

extract_pdf &amp;lt;- function(url, pag = 1) {
  
  if (pag == 2) {
    url &amp;lt;- url %&amp;gt;%
      read_html() %&amp;gt;%
      html_nodes(&amp;quot;.pager-item a&amp;quot;) %&amp;gt;%
      html_attr(&amp;quot;href&amp;quot;) %&amp;gt;%
      map(~ paste0(&amp;quot;https://parlamento.gub.uy&amp;quot;, .)) %&amp;gt;%
      unlist()
    }
  
  pdfs &amp;lt;- url %&amp;gt;%
    read_html() %&amp;gt;%
    html_nodes(&amp;quot;.views-field-DS-File-IMG a&amp;quot;) %&amp;gt;%   # seleccionar clase
    html_attr(&amp;quot;href&amp;quot;) %&amp;gt;%
    map(~ paste0(&amp;quot;https://parlamento.gub.uy&amp;quot;, .)) %&amp;gt;%
    map(~ paste0(pdf_text(.), collapse = &#39; &#39;)) %&amp;gt;%
    map(~ stri_trans_general(tolower(.), id = &amp;quot;latin-ascii&amp;quot;)) %&amp;gt;%
    map(~ stri_replace_all(., replacement = &amp;quot;&amp;quot;, regex = &amp;quot;\\\n&amp;quot;)) %&amp;gt;% 
    map_df(function(pdf) {tibble(pdf)})
  
  return(pdfs)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;La primera parte de la funci칩n es la que voy a ignorar, donde lo que hago es modificar la url para indicar que quiero ir a la segunda p치gina (se puede aplicar la misma l칩gica que la que voy a usar a continuaci칩n para interpretar esta parte del c칩digo).&lt;/p&gt;

&lt;p&gt;Lo interesante pasa cuando empiezo a procesar la url: &lt;code&gt;read_html()&lt;/code&gt; &amp;ldquo;lee&amp;rdquo; el contenido de la p치gina, para que pueda buscar lo que me interesa. Mi objetivo es encontrar todos los archivos pdf (por eso me interesaba conocer &lt;em&gt;el nombre de la clase&lt;/em&gt; de esos elementos, que descubr칤 antes). Con &lt;code&gt;html_nodes()&lt;/code&gt; voy extrayendo los &lt;em&gt;nodos&lt;/em&gt; (tampoco nos preocupemos ahora por saber qu칠 son exactamente), y en este caso el &lt;em&gt;nodo&lt;/em&gt; que me interesa es &lt;code&gt;.views-field-DS-File-IMG a&lt;/code&gt;:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;tiene un punto adelante para indicar que se trata de elementos de una clase, seguido del nombre de la clase &lt;code&gt;views-field-DS-File-IMG&lt;/code&gt; (lo que copiamos con el &lt;em&gt;Selector Gadget&lt;/em&gt;),&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;a&lt;/code&gt; es la etiqueta que html usa para definir elementos que son un hiperv칤nculo.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Ahora puedo seleccionar el atributo &lt;code&gt;href&lt;/code&gt;, que es el link al pdf, con la funci칩n &lt;code&gt;html_attr()&lt;/code&gt;. Ac치 hay que tener cuidado porque la ruta es relativa (es decir que falta poner &amp;ldquo;&lt;a href=&#34;https://parlamento.gub.uy&amp;quot;&#34;&gt;https://parlamento.gub.uy&amp;quot;&lt;/a&gt; antes para tener la ruta completa).&lt;/p&gt;

&lt;p&gt;Al aplicar la funci칩n hasta ac치, lo que tengo es una lista con una url por cada pdf que aparece en la p치gina. Por eso luego uso la funci칩n &lt;code&gt;purrr::map()&lt;/code&gt; para aplicar a cada elemento de la lista (cada link a los pdfs), una funci칩n. Las transformaciones que aplico a cada elemento de la lista son, en forma sucesiva, las siguientes:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;paste0(&amp;quot;https://parlamento.gub.uy&amp;quot;, .)&lt;/code&gt; completo la ruta absoluta, pegando &amp;ldquo;&lt;a href=&#34;https://parlamento.gub.uy&amp;quot;&#34;&gt;https://parlamento.gub.uy&amp;quot;&lt;/a&gt; adelante del link relativo,&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;paste0(pdf_text(.), collapse = &#39; &#39;)&lt;/code&gt; usando el paquete &lt;code&gt;pdftools&lt;/code&gt; extraigo la informaci칩n del pdf con la funci칩n &lt;code&gt;pdf_text()&lt;/code&gt; y colapso todas las p치ginas en un mismo string,&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;stri_trans_general(tolower(.), id = &amp;quot;latin-ascii&amp;quot;)&lt;/code&gt; saco los caracteres especiales y dejo todo en min칰scula,&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;stri_replace_all(., replacement = &amp;quot;&amp;quot;, regex = &amp;quot;\\\n&amp;quot;)&lt;/code&gt; elimino los saltos de l칤nea,&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;tibble(pdf)&lt;/code&gt; transformo la lista en un dataframe.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Entonces ahora extraigo los pdfs de las dos p치ginas y los junto en un 칰nico dataframe (voy a mostrar el proceso para Diputados, pero es an치logo para Senadores).&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;pdf_diputados_pag1 &amp;lt;- extract_pdf(url_diputados, pag = 1)
pdf_diputados_pag2 &amp;lt;- extract_pdf(url_diputados, pag = 2)

pdf_diputados &amp;lt;- bind_rows(pdf_diputados_pag1, pdf_diputados_pag2)

library(knitr)
library(kableExtra)

knitr::kable(head(pdf_diputados) %&amp;gt;%
               select(pdf) %&amp;gt;% 
               mutate(pdf = substr(pdf, start=1, stop=500)),
             format = &amp;quot;html&amp;quot;) 
&lt;/code&gt;&lt;/pre&gt;

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; pdf &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4151                                                          montevideo, miercoles 14 de marzo de 2018
                  republica oriental del uruguay
                        diario de sesiones
                camara de representantes
                               5춹 sesion (extraordinaria)
                                      preside el senor representante
                                               jorge gandini
                                                 (presidente) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4148                                                              montevideo, martes 6 de marzo de 2018
                  republica oriental del uruguay
                        diario de sesiones
                camara de representantes
                                                2춹 sesion
                                  presiden los senores representantes
                                                jorge gandini
                                                  (presidente) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4147                                                              montevideo, jueves 1춿 de marzo de 2018
                  republica oriental del uruguay
                        diario de sesiones
                camara de representantes
                                               1춹 sesion
                                      preside el senor representante
                                               jorge gandini
                                                 (presidente) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4146                                                             montevideo, jueves 8 de febrero de 2018
                  republica oriental del uruguay
                         diario de sesiones
                camara de representantes
                               3춹 sesion (extraordinaria)
                                  presiden los senores representantes
                                           prof. jose carlos mahia
                                                   (preside &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4145                                                  montevideo, miercoles 7 de febrero de 2018
                 republica oriental del uruguay
                    diario de sesiones
                camara de representantes
                       2춹 sesion (extraordinaria)
                             preside el senor representante
                                  prof. jose carlos mahia
                                          (presidente)
                             actuan en secret &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4144                                                         montevideo, miercoles 20 de diciembre de 2017
                  republica oriental del uruguay
                         diario de sesiones
                camara de representantes
                               1춹 sesion (extraordinaria)
                                  presiden los senores representantes
                                           prof. jose carlos mahia
                                                   (presi &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;advertencia&#34;&gt;丘멆잺 Advertencia 丘멆잺&lt;/h3&gt;

&lt;p&gt;La funci칩n &lt;code&gt;pdftools::read_pdf()&lt;/code&gt; lee los renglones de izquierda a derecha. En los Diarios de Sesiones hay algunas p치ginas que se organizan con texto en dos columnas, entonces hay renglones que, le칤dos de esa forma, quedan incoherentes. Esto hay que tenerlo en cuenta para ver si el tipo de an치lisis que quiero hacer tiene sentido o no. Por ejemplo, si lo que quiero es analizar &lt;a href=&#34;https://es.wikipedia.org/wiki/N-grama&#34;&gt;&lt;em&gt;n-gramas&lt;/em&gt;&lt;/a&gt; donde el orden de las palabras es importante, voy a tener problemas porque estar칤a considerando palabras de distintas columnas de texto, como si vinieran una a continuaci칩n de la otra. Para analizar sentimiento con &lt;a href=&#34;https://es.wikipedia.org/wiki/Modelo_bolsa_de_palabras&#34;&gt;&lt;em&gt;bolsa de palabras (bag of words)&lt;/em&gt;&lt;/a&gt; no hay problema, porque el orden de las palabras no es relevante.&lt;/p&gt;

&lt;h2 id=&#34;extraigo-fecha-y-n칰mero-de-sesi칩n&#34;&gt;Extraigo fecha y n칰mero de sesi칩n&lt;/h2&gt;

&lt;p&gt;Hago una segunda funci칩n para extraer otros la fecha y el n칰mero de la sesi칩n, porque se puede dar el caso de tener m치s de una sesi칩n en la misma fecha.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;extract_metadata &amp;lt;- function(url, info, pag = 1){
  if (info == &amp;quot;fecha&amp;quot;) nodes = &amp;quot;td.views-field-DS-Fecha&amp;quot;
  if (info == &amp;quot;sesion&amp;quot;) nodes = &amp;quot;td.views-field-Ssn-Nro&amp;quot;
  if (pag == 2){
    url &amp;lt;- url %&amp;gt;%
      read_html() %&amp;gt;%
      html_nodes(&amp;quot;.pager-item a&amp;quot;) %&amp;gt;%
      html_attr(&amp;quot;href&amp;quot;) %&amp;gt;%
      map(~ paste0(&amp;quot;https://parlamento.gub.uy&amp;quot;, .)) %&amp;gt;%
      unlist() 
    }
  
  url %&amp;gt;% 
    read_html() %&amp;gt;% 
    html_nodes(nodes) %&amp;gt;% 
    html_text() %&amp;gt;% 
    map(~str_extract(., &amp;quot;[0-9\\-]+&amp;quot;)) %&amp;gt;%  # esta expresi칩n regular matchea tanto la fecha como el n칰mero de sesi칩n
    unlist()
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Extraigo la fecha y la sesi칩n.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# extraigo fechas
pdf_fechas_diputados_pag1 &amp;lt;- extract_metadata(url_diputados, info = &amp;quot;fecha&amp;quot;, pag = 1)
pdf_fechas_diputados_pag2 &amp;lt;- extract_metadata(url_diputados, info = &amp;quot;fecha&amp;quot;, pag = 2)

# junto todos las fechas y las convierto en un df
pdf_fechas_diputados &amp;lt;- c(pdf_fechas_diputados_pag1, pdf_fechas_diputados_pag2) %&amp;gt;% 
  tbl_df() %&amp;gt;% 
  transmute(fecha = as.Date(value, &amp;quot;%d-%m-%Y&amp;quot;))

# extraigo sesiones
pdf_sesion_diputados_pag1 &amp;lt;- extract_metadata(url_diputados, info = &amp;quot;sesion&amp;quot;, pag = 1)
pdf_sesion_diputados_pag2 &amp;lt;- extract_metadata(url_diputados, info = &amp;quot;sesion&amp;quot;, pag = 2)

# junto todos las sesiones y las convierto en un df
pdf_sesion_diputados &amp;lt;- c(pdf_sesion_diputados_pag1, pdf_sesion_diputados_pag2) %&amp;gt;% 
  tbl_df() %&amp;gt;% 
  rename(sesion = value)

knitr::kable(head(pdf_sesion_diputados) %&amp;gt;% select(fecha),
             format = &amp;quot;html&amp;quot;) 
&lt;/code&gt;&lt;/pre&gt;

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-14 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-06 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-01 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-08 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-07 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-12-20 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;knitr::kable(head(pdf_sesion_diputados) %&amp;gt;% select(sesion),
             format = &amp;quot;html&amp;quot;) 
&lt;/code&gt;&lt;/pre&gt;

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; sesion &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 3 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
Juntando todo, armo el dataframe de Diputados con la fecha, la sesi칩n y el texto del pdf.


```r
diputados &lt;- bind_cols(pdf_fechas_diputados, pdf_sesion_diputados, pdf_diputados) %&gt;% 
  unite(&#34;fecha_sesion&#34;, c(fecha, sesion), remove = FALSE) %&gt;%
  distinct() # la primer sesi칩n de la segunda p치gina es igual a la 칰ltima sesi칩n de la primera p치gina
```

Con este dataframe es con el que voy a trabajar para los Diputados, que tiene 66 sesiones.


```r
knitr::kable(head(diputados) %&gt;% 
               mutate(pdf = substr(pdf, start=1, stop=500)), 
             format = &#34;html&#34;) 
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha_sesion &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; sesion &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; pdf &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-14_5 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-14 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 5 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4151                                                          montevideo, miercoles 14 de marzo de 2018
                  republica oriental del uruguay
                        diario de sesiones
                camara de representantes
                               5춹 sesion (extraordinaria)
                                      preside el senor representante
                                               jorge gandini
                                                 (presidente) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-06_2 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-06 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4148                                                              montevideo, martes 6 de marzo de 2018
                  republica oriental del uruguay
                        diario de sesiones
                camara de representantes
                                                2춹 sesion
                                  presiden los senores representantes
                                                jorge gandini
                                                  (presidente) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-01_1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-01 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4147                                                              montevideo, jueves 1춿 de marzo de 2018
                  republica oriental del uruguay
                        diario de sesiones
                camara de representantes
                                               1춹 sesion
                                      preside el senor representante
                                               jorge gandini
                                                 (presidente) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-08_3 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-08 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 3 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4146                                                             montevideo, jueves 8 de febrero de 2018
                  republica oriental del uruguay
                         diario de sesiones
                camara de representantes
                               3춹 sesion (extraordinaria)
                                  presiden los senores representantes
                                           prof. jose carlos mahia
                                                   (preside &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-07_2 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-07 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4145                                                  montevideo, miercoles 7 de febrero de 2018
                 republica oriental del uruguay
                    diario de sesiones
                camara de representantes
                       2춹 sesion (extraordinaria)
                             preside el senor representante
                                  prof. jose carlos mahia
                                          (presidente)
                             actuan en secret &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-12-20_1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-12-20 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4144                                                         montevideo, miercoles 20 de diciembre de 2017
                  republica oriental del uruguay
                         diario de sesiones
                camara de representantes
                               1춹 sesion (extraordinaria)
                                  presiden los senores representantes
                                           prof. jose carlos mahia
                                                   (presi &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Y con este dataframe es con el que voy a trabajar para los Senadores, que tiene 59 sesiones.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;knitr::kable(head(senadores) %&amp;gt;% 
               mutate(pdf = substr(pdf, start=1, stop=500)), 
             format = &amp;quot;html&amp;quot;) 
&lt;/code&gt;&lt;/pre&gt;

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha_sesion &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; sesion &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; pdf &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-06_1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-06 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; n.췈 1 - tomo 578                                                                                                      6 de marzo de 2018                                            republica oriental del uruguay                           diario de sesiones                                                                      de la                  camara de senadores                                      cuarto periodo de la xlviii legislatura &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-27_57 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-27 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 57 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; n.췈 57 - tomo 577                                                                                                    27 de febrero de 2018                                            republica oriental del uruguay                            diario de sesiones                                                                       de la                camara de senadores                                       tercer periodo de la xlviii legislatura                                                   57 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-21_56 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-21 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 56 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; n.췈 56 - tomo 577                                                                                                   21 de febrero de 2018                                            republica oriental del uruguay                            diario de sesiones                                                                       de la                camara de senadores                                       tercer periodo de la xlviii legislatura                                                  56.춹 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-07_55 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-07 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 55 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; n.췈 55 - tomo 577                                                                                                       7 de febrero de 2018                                            republica oriental del uruguay                           diario de sesiones                                                                      de la                camara de senadores                                       tercer periodo de la xlviii legislatura                                                  55. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-06_54 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-06 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 54 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; n.췈 54 - tomo 577                                                                                                    6 de febrero de 2018                                            republica oriental del uruguay                           diario de sesiones                                                                      de la                camara de senadores                                       tercer periodo de la xlviii legislatura                                                  54.춹 s &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-12-27_53 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-12-27 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 53 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; n.췈 53 - tomo 577                                                                                                27 de diciembre de 2017                                            republica oriental del uruguay                           diario de sesiones                                                                      de la                camara de senadores                                       tercer periodo de la xlviii legislatura                                                  53.춹 se &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&#34;tad치&#34;&gt;Tad치 游꿀&lt;/h1&gt;

&lt;p&gt;Ahora con los datos en este formato, estoy en condiciones de analizar las sesiones!&lt;/p&gt;

&lt;p&gt;Para m치s informaci칩n acerca de c칩mo trabajar con datos de la web, hay un &lt;a href=&#34;https://www.datacamp.com/community/tutorials/r-web-scraping-rvest&#34;&gt;tutorial de Arvid Kingl en Datacamp en ingl칠s para usar &lt;code&gt;rvest&lt;/code&gt;&lt;/a&gt; y hay un &lt;a href=&#34;https://www.datacamp.com/courses/working-with-web-data-in-r&#34;&gt;curso de Charlotte Wickham y Oliver Keyes, tambi칠n en ingl칠s y en Datacamp,&lt;/a&gt; que habla adem치s de otras formas de consumir datos de la web, como a trav칠s de APIs.&lt;/p&gt;

&lt;p&gt;Si quer칠s analizar las sesiones fuera de R, o prefer칤s ahorrarte el paso de hacer scraping, &lt;a href=&#34;https://github.com/d4tagirl/uruguayan_parliamentary_session_diary/blob/master/data/diputados.csv&#34;&gt;ac치 ten칠s las sesiones de Diputados en formato csv&lt;/a&gt;, y &lt;a href=&#34;https://github.com/d4tagirl/uruguayan_parliamentary_session_diary/blob/master/data/senadores.csv&#34;&gt;ac치 las sesiones de Senadores en formato csv&lt;/a&gt; para hacer tus an치lisis! (Gracias &lt;a href=&#34;https://twitter.com/rolaguna&#34;&gt;Rodrigo&lt;/a&gt; por la sugerencia!)&lt;/p&gt;

&lt;p&gt;Todo lo que us칠 en este art칤culo (y m치s!) est치 &lt;a href=&#34;https://github.com/d4tagirl/uruguayan_parliamentary_session_diary&#34;&gt;disponible en GitHub&lt;/a&gt;. Espero que haya resultado 칰til! Dejame tus comentarios abajo o &lt;a href=&#34;https://twitter.com/intent/tweet?user_id=114258616&#34;&gt;mencioname en Twitter&lt;/a&gt; 游땎&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
