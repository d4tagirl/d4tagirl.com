<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>diputados on d4tagirl</title>
    <link>/tags/diputados/</link>
    <description>Recent content in diputados on d4tagirl</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Sun, 08 Apr 2018 17:11:29 +0000</lastBuildDate>
    
        <atom:link href="/tags/diputados/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>¬øDe qu√© se habl√≥ en el Parlamento uruguayo desde 2017?</title>
      <link>/2018/04/de-qu%C3%A9-se-habl%C3%B3-en-el-parlamento-uruguayo-desde-2017/</link>
      <pubDate>Sun, 08 Apr 2018 17:11:29 +0000</pubDate>
      
      <guid>/2018/04/de-qu%C3%A9-se-habl%C3%B3-en-el-parlamento-uruguayo-desde-2017/</guid>
      <description>

&lt;p&gt;En el art√≠culo pasado &lt;a href=&#34;/2018/04/scrapeando-las-sesiones-parlamentarias-de-uruguay/&#34;&gt;mostr√© c√≥mo se pueden obtener los textos de los Diarios de Sesiones&lt;/a&gt;. Primero obtuve los archivos pdf haciendo &lt;a href=&#34;https://es.wikipedia.org/wiki/Web_scraping&#34;&gt;&lt;em&gt;web scraping&lt;/em&gt;&lt;/a&gt; y despu√©s extraje los textos de esos archivos.&lt;/p&gt;

&lt;p&gt;Ahora que tengo los datos, en este art√≠culo analizo el texto de las sesiones de Diputados y Senadores desde 2017 usando el paquete &lt;a href=&#34;https://github.com/juliasilge/tidytext&#34;&gt;tidytext&lt;/a&gt;, centr√°ndome en el sentimiento y en identificar los temas tratados.&lt;/p&gt;

&lt;h1 id=&#34;levanto-los-datos&#34;&gt;Levanto los datos&lt;/h1&gt;

&lt;p&gt;Levanto los datos que obtuve del scraping de &lt;a href=&#34;https://github.com/d4tagirl/uruguayan_parliamentary_session_diary&#34;&gt;mi repositorio de GitHub&lt;/a&gt; y les saco los saltos de l√≠nea (los dej√© porque para alg√∫n an√°lisis podr√≠a servir tenerlos).&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(dplyr)
library(stringi)

url_rds_diputados &amp;lt;- &#39;https://github.com/d4tagirl/uruguayan_parliamentary_session_diary/raw/master/data/pdf_diputados&#39;
diputados &amp;lt;- readRDS(url(url_rds_diputados)) 

url_rds_senadores &amp;lt;- &#39;https://github.com/d4tagirl/uruguayan_parliamentary_session_diary/raw/master/data/pdf_senadores&#39;
senadores &amp;lt;- readRDS(url(url_rds_senadores)) 

# saco los saltos de linea
diputados &amp;lt;- diputados %&amp;gt;%
  mutate(pdf = stri_replace_all(pdf, replacement = &amp;quot;&amp;quot;, regex = &amp;quot;\\\n&amp;quot;))

senadores &amp;lt;- senadores %&amp;gt;%
  mutate(pdf = stri_replace_all(pdf, replacement = &amp;quot;&amp;quot;, regex = &amp;quot;\\\n&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;con-qu√©-frecuencia-se-reunieron&#34;&gt;Con qu√© frecuencia se reunieron?&lt;/h1&gt;

&lt;p&gt;Como quiero averiguar la cantidad de sesiones por mes-a√±o, porque tengo m√°s de un mes de enero (el enero de 2017 y el de 2018), busqu√© y me qued√© muy contenta de encontrar la funci√≥n &lt;code&gt;zoo::as.yearmon()&lt;/code&gt; que extrae exactamente esa informaci√≥n de una fecha!&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(ggplot2)
library(scales)
library(zoo)
library(lubridate)

freq_diputados &amp;lt;- ggplot(diputados, aes(as.factor(as.yearmon(fecha)), fill=as.factor(as.yearmon(fecha)))) + 
  geom_bar(position=&#39;dodge&#39;, show.legend = FALSE) + 
  ylab(&amp;quot;Cantidad&amp;quot;) + 
  xlab(&amp;quot;&amp;quot;) + 
  scale_x_discrete(limits = as.factor(as.yearmon(seq.Date(floor_date(min(diputados$fecha), &amp;quot;month&amp;quot;),
                                                          floor_date(max(diputados$fecha), &amp;quot;month&amp;quot;), &amp;quot;month&amp;quot;)))) +
  theme_minimal() +
  theme(axis.text.x=element_blank()) +
  ggtitle(&amp;quot;Sesiones de Diputados&amp;quot;)

freq_senadores &amp;lt;- ggplot(senadores, aes(as.factor(as.yearmon(fecha)), fill=as.factor(as.yearmon(fecha)))) + 
  geom_bar(position=&#39;dodge&#39;, show.legend = FALSE) +
  xlab(&amp;quot;&amp;quot;) + 
  ylab(&amp;quot;Cantidad&amp;quot;) +
  scale_x_discrete(limits = as.factor(as.yearmon(seq.Date(floor_date(min(senadores$fecha), &amp;quot;month&amp;quot;), floor_date(max(senadores$fecha), &amp;quot;month&amp;quot;), &amp;quot;month&amp;quot;)))) +
  theme_minimal() +
  theme(axis.text.x  = element_text(angle=45,
                                    hjust = 1,
                                    vjust = 1)) +
  ggtitle(&amp;quot;Sesiones de Senadores&amp;quot;)

library(gridExtra)
grid.arrange(freq_diputados, freq_senadores)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;/post/de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/2018-04-08-de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/histograma-1.png&#34; style=&#34;margin: auto;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Seg√∫n &lt;a href=&#34;https://www.enperspectiva.net/home/regimen-laboral-de-los-parlamentarios-uruguayos/&#34;&gt;esta nota de &amp;ldquo;En Perspectiva&amp;rdquo;&lt;/a&gt; que encontr√©, &lt;em&gt;&amp;ldquo;El r√©gimen de sesiones ordinarias, [&amp;hellip;] en ambas C√°maras se desarrollan los d√≠as martes y mi√©rcoles, entre el 1¬∫ y el 18 de cada mes. [&amp;hellip;] luego del d√≠a 18 puede haber sesiones extraordinarias, donde se considera cualquier tema.&amp;rdquo;&lt;/em&gt; Seg√∫n mis c√°lculos tiene que haber como m√≠nimo entre 4 y 6 sesiones mensuales. Los diputados lo cumplieron todos los meses exceptuando enero de 2017, febrero de ambos a√±os y marzo de 2018 (meses asociados al verano y las licencias). Los Senadores lo cumplieron todos los meses exceptuando febrero de 2017, setiembre de 2017 (quiz√°s vacaciones de primavera?), enero de 2018 y marzo de 2018. Sospecho que a√∫n no subieron todas las sesiones de marzo de 2018 y por eso aparecen tan pocas sesiones para ambas C√°maras.&lt;/p&gt;

&lt;p&gt;Tanto Diputados como Senadores tuvieron un m√°ximo de sesiones mensuales de 8, con una frecuencia mayor entre marzo y diciembre. Diciembre, como ya sospechaba, es un mes ocupado en el Parlamento.&lt;/p&gt;

&lt;h1 id=&#34;qu√©-tan-largas-fueron-las-sesiones&#34;&gt;Qu√© tan largas fueron las sesiones?&lt;/h1&gt;

&lt;p&gt;Asumir que la cantidad de palabras en una sesi√≥n es una buena forma de aproximarme a la duraci√≥n de la sesi√≥n, parece bastante razonable. Nunca estuve en una sesi√≥n, pero no me imagino a los parlamentarios reunidos y sin hablar üó£Ô∏è&lt;/p&gt;

&lt;p&gt;Primero transformo los datos para generar un dataframe con la cantidad de palabras en promedio por sesi√≥n en cada mes (lo muestro para diputados, es an√°logo para senadores).&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(tidytext)

# calculo las palabras por mes
sesion_diputados_words_mes &amp;lt;- diputados %&amp;gt;%
  unnest_tokens(word, pdf) %&amp;gt;%
  mutate(mes = as.yearmon(fecha)) %&amp;gt;% 
  count(mes, sort = TRUE) %&amp;gt;%
  ungroup()

# calculo la cantidad de sesiones por mes
cant_sesiones_diputados_mes &amp;lt;- diputados %&amp;gt;% 
  group_by(mes = as.yearmon(fecha)) %&amp;gt;% 
  summarise(cant_sesiones = n()) %&amp;gt;%
  ungroup()

# los junto
sesion_diputados_words_mes &amp;lt;- left_join(sesion_diputados_words_mes, cant_sesiones_diputados_mes) %&amp;gt;% 
  mutate(palabras_prom_sesion = n/cant_sesiones)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Y ahora los grafico:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;prom_palabras_sesiones_diputados &amp;lt;- ggplot(sesion_diputados_words_mes, aes(x = as.factor(mes), fill=as.factor(mes))) + 
  geom_col(aes(y = palabras_prom_sesion), show.legend = FALSE) + 
  scale_y_continuous(limit=c(0,150000)) +
  ylab(&amp;quot;Cantidad de palabras promedio\nde las sesiones del mes&amp;quot;) + 
  xlab(&amp;quot;&amp;quot;) + 
  scale_x_discrete(limits = as.factor(as.yearmon(seq.Date(floor_date(min(senadores$fecha), &amp;quot;month&amp;quot;),
                                                          floor_date(max(senadores$fecha), &amp;quot;month&amp;quot;), &amp;quot;month&amp;quot;)))) +
  theme_minimal() +
  theme(axis.text.x=element_blank()) +
  ggtitle(&amp;quot;Cantidad de palabras promedio en sesiones de Diputados&amp;quot;)

prom_palabras_sesiones_senadores &amp;lt;- ggplot(sesion_senadores_words_mes, aes(x = as.factor(mes), fill=as.factor(mes))) + 
  geom_col(aes(y = palabras_prom_sesion), show.legend = FALSE) + 
  scale_y_continuous(limit=c(0,150000)) + 
  scale_x_discrete(limits = as.factor(as.yearmon(seq.Date(floor_date(min(senadores$fecha), &amp;quot;month&amp;quot;),
                                                          floor_date(max(senadores$fecha), &amp;quot;month&amp;quot;), &amp;quot;month&amp;quot;)))) +
  xlab(&amp;quot;&amp;quot;) + 
  ylab(&amp;quot;Cantidad de palabras promedio\nde las sesiones del mes&amp;quot;) +
  theme_minimal() +
  theme(axis.text.x  = element_text(angle=45,
                                    hjust = 1,
                                    vjust = 1)) +
  ggtitle(&amp;quot;Cantidad de palabras promedio en sesiones de Senadores&amp;quot;)

grid.arrange(prom_palabras_sesiones_diputados, prom_palabras_sesiones_senadores)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;/post/de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/2018-04-08-de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/unnamed-chunk-1-1.png&#34; style=&#34;margin: auto;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Hubo una sola sesion de diputados en febrero de 2017, pero fue mucho m√°s extensa que las dem√°s. Despu√©s vamos a ver que tuvo que ver con la &lt;a href=&#34;https://www.minterior.gub.uy/index.php/component/content/article/2-uncategorised/4410-bonomi-sobre-la-violencia-en-el-deporte&#34;&gt;interpelaci√≥n del Ministro del Interior Eduardo Bonomi por una situaci√≥n de extrema violencia en el f√∫tbol&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Adem√°s en las sesiones de senadores se habl√≥ menos (probablemente sean m√°s cortas). Tiene sentido porque son 30 los senadores, mientras que los diputados son 99!&lt;/p&gt;

&lt;h1 id=&#34;palabras-m√°s-com√∫nes&#34;&gt;Palabras m√°s com√∫nes&lt;/h1&gt;

&lt;p&gt;Las palabras m√°s com√∫nes de todas las sesiones de ambas C√°maras son las que aparecen a continuaci√≥n (como siempre, muestro el c√≥digo para Diputados, y para Senadores es an√°logo).&lt;/p&gt;

&lt;p&gt;Para contar palabras, es buena pr√°ctica sacar las palabras com√∫nes como &amp;ldquo;y&amp;rdquo;, &amp;ldquo;el&amp;rdquo;, &amp;ldquo;es&amp;rdquo;, com√∫nmente llamadas &amp;ldquo;stopwords&amp;rdquo;. No hay tantos diccionarios disponibles para espa√±ol como para ingl√©s, pero algunos hay! Ac√° voy a usar las stopwords incluidas en el paquete &lt;code&gt;rcorpora&lt;/code&gt; para espa√±ol.&lt;/p&gt;

&lt;p&gt;Las palabras m√°s usadas en las Sesiones de Diputados:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(rcorpora)
library(viridis)
stopwords &amp;lt;- corpora(&amp;quot;words/stopwords/es&amp;quot;)$stopWords

stopwords &amp;lt;- c(stopwords, as.character(seq(1:50)))

# Diputados
tidy_diputados &amp;lt;- diputados %&amp;gt;%
  tidytext::unnest_tokens(word, pdf) %&amp;gt;% 
  filter(!word %in% stopwords) 

most_used_dip &amp;lt;- tidy_diputados %&amp;gt;%
  count(word, sort = TRUE) %&amp;gt;%
  ungroup()

most_used_dip %&amp;gt;%
  top_n(30) %&amp;gt;%
  ungroup() %&amp;gt;%
  mutate(word = reorder(word, n)) %&amp;gt;%
  ggplot(aes(word, n, fill = word)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  theme_minimal() +
  theme(axis.title.y =element_blank() , axis.title.x =element_blank()) + 
  scale_fill_viridis(discrete = TRUE) +
  ggtitle(&amp;quot;Palabras m√°s usadas en Sesiones de Diputados&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;/post/de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/2018-04-08-de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/most_common_words_diputados-1.png&#34; style=&#34;margin: auto;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Las m√°s usadas en las Sesiones de Senadores:&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/post/de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/2018-04-08-de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/most_common_words_senadores-1.png&#34; style=&#34;margin: auto;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;No nos dice mucho esta informaci√≥n: son palabras que protocolarmente se utilizan en estos entornos, as√≠ como nombres de pol√≠ticos. Para lo √∫nico que nos sirve es para confirmar que efectivamente tiene sentido que estos textos sean los de los Diarios de Sesiones, y no otra cosa üòÇ&lt;/p&gt;

&lt;h1 id=&#34;an√°lisis-de-sentimiento&#34;&gt;An√°lisis de Sentimiento&lt;/h1&gt;

&lt;p&gt;Me cost√≥ un poquito m√°s encontrar un diccionario en espa√±ol que tuviera sentimiento, pero &lt;a href=&#34;http://web.eecs.umich.edu/~mihalcea/downloads/SpanishSentimentLexicons.tar.gz&#34;&gt;encontr√© este que es el que voy a usar&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Levanto el diccionario, que llamo &lt;code&gt;lexicon&lt;/code&gt; (lo levanto de mi repositorio de GitHub para asegurarme de que siempre est√© disponible).&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(readr)

url_lexicon &amp;lt;- &#39;https://raw.githubusercontent.com/d4tagirl/uruguayan_parliamentary_session_diary/master/SpanishSentimentLexicons/fullStrengthLexicon.txt&#39;

lexicon &amp;lt;- read_tsv(url(url_lexicon),
                    col_names = FALSE) %&amp;gt;% 
  select(X1, X3) %&amp;gt;% 
  rename(palabra = X1, sentimiento = X3)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Este diccionario tiene 1347 palabras, 476 positivas y 871 negativas. Podemos decir que es un diccionario bastante negativo. Es importante para despu√©s analizar los resultados, saber si es balanceado o no un diccionario.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tidy_diputados &amp;lt;- diputados %&amp;gt;%
  tidytext::unnest_tokens(word, pdf) %&amp;gt;% 
  filter(!word %in% stopwords) 

tidy_diputados %&amp;gt;%  
  inner_join(lexicon, by = c(&amp;quot;word&amp;quot; = &amp;quot;palabra&amp;quot;)) %&amp;gt;%
  count(word, sentimiento, sort = TRUE) %&amp;gt;%
  ungroup() %&amp;gt;%
  group_by(sentimiento) %&amp;gt;%
  top_n(20) %&amp;gt;%
  ungroup() %&amp;gt;%
  mutate(word = reorder(word, n)) %&amp;gt;%
  ggplot(aes(word, n, fill = sentimiento)) +
  geom_col(show.legend = FALSE) +
  scale_fill_viridis(discrete = TRUE) +
  facet_wrap(~sentimiento, scales = &amp;quot;free_y&amp;quot;) +
  labs(y = NULL, x = NULL) +
  coord_flip() +
  ggtitle(&amp;quot;Palabras con sentimientos m√°s extremos en\nsesiones de Diputados&amp;quot;) + 
  theme_minimal()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;/post/de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/2018-04-08-de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/unnamed-chunk-3-1.png&#34; style=&#34;margin: auto;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Hay algunas palabras que aparecen con una carga de sentimiento que, dado el contexto, no es apropiado que la tengan. Por ejemplo: &amp;ldquo;consideracion&amp;rdquo;, &amp;ldquo;especial&amp;rdquo; o &amp;ldquo;atenci√≥n&amp;rdquo;. Y otras con las que no estoy de acuerdo, como que la palabra &amp;ldquo;negro&amp;rdquo; est√© clasificada como negativa. As√≠ que las agrego como stopwords as√≠ no las considero.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;stopwords_personalizadas &amp;lt;- c(stopwords, &amp;quot;negro&amp;quot;, &amp;quot;discusion&amp;quot;, &amp;quot;atento&amp;quot;, &amp;quot;consideracion&amp;quot;,
                              &amp;quot;especial&amp;quot;, &amp;quot;dicha&amp;quot;, &amp;quot;facultades&amp;quot;, &amp;quot;atencion&amp;quot;, &amp;quot;asunto&amp;quot;)

tidy_diputados &amp;lt;- diputados %&amp;gt;%
  tidytext::unnest_tokens(word, pdf) %&amp;gt;% 
  filter(!word %in% stopwords_personalizadas) 

tidy_diputados %&amp;gt;%  
  inner_join(lexicon, by = c(&amp;quot;word&amp;quot; = &amp;quot;palabra&amp;quot;)) %&amp;gt;%
  count(word, sentimiento, sort = TRUE) %&amp;gt;%
  ungroup() %&amp;gt;%
  group_by(sentimiento) %&amp;gt;%
  top_n(20) %&amp;gt;%
  ungroup() %&amp;gt;%
  mutate(word = reorder(word, n)) %&amp;gt;%
  ggplot(aes(word, n, fill = sentimiento)) +
  geom_col(show.legend = FALSE) +
  scale_fill_viridis(discrete = TRUE) +
  facet_wrap(~sentimiento, scales = &amp;quot;free_y&amp;quot;) +
  labs(y = NULL, x = NULL) +
  coord_flip() +
  theme_minimal()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;/post/de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/2018-04-08-de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/unnamed-chunk-4-1.png&#34; style=&#34;margin: auto;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Ac√° est√°n las 20 palabras m√°s usadas por Diputados, separadas por sentimiento en negativas y positivas. Ahora tiene m√°s sentido, sobre todo para los que vivimos en Uruguay. Que la primera palabra sea renuncia, cuando &lt;a href=&#34;https://www.elmundo.es/internacional/2017/09/09/59b42150ca47411b3a8b4600.html&#34;&gt;en setiempre de 2017 renunci√≥ el Vice Presidente de la Rep√∫blica&lt;/a&gt;, tiene mucho sentido! No estoy del todo conforme con las palabras positivas, porque transporte no me queda claro que sea positivo, pero lo voy a dejar as√≠.&lt;/p&gt;

&lt;p&gt;A continuaci√≥n las palabras m√°s usadas por Senadores, separadas por sentimiento.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/post/de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/2018-04-08-de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/unnamed-chunk-5-1.png&#34; style=&#34;margin: auto;&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;sentimiento-en-los-distintos-meses&#34;&gt;Sentimiento en los distintos meses&lt;/h2&gt;

&lt;p&gt;Separo por mes y veo el sentimiento en los distintos meses. Este an√°lisis lo hago para ver c√≥mo fue era el clima en los distintos momentos del a√±o, y despu√©s lo voy a mirar por sesiones.&lt;/p&gt;

&lt;p&gt;Para Diputados:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(tidyr)

tidy_diputados  %&amp;gt;%
  inner_join(lexicon, by = c(&amp;quot;word&amp;quot; = &amp;quot;palabra&amp;quot;)) %&amp;gt;%
  group_by(mes = as.yearmon(fecha)) %&amp;gt;% 
  count(sentimiento) %&amp;gt;%
  ungroup %&amp;gt;% 
  spread(sentimiento, n, fill = 0) %&amp;gt;%
  mutate(sentimiento = pos - neg) %&amp;gt;% 
  arrange(mes) %&amp;gt;% 
  ggplot(aes(as.factor(mes), sentimiento)) +
  geom_col(aes(fill = sentimiento &amp;gt; 0), show.legend = FALSE) +
  theme_minimal() +
  theme(axis.title.x=element_blank(), axis.text.x  = element_text(angle=45,
                                                                  hjust = 1,
                                                                  vjust = 1)) +
  scale_fill_viridis(discrete = TRUE)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;/post/de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/2018-04-08-de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/unnamed-chunk-6-1.png&#34; style=&#34;margin: auto;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Parece haber una mejora del clima en setiembre, que coincide con la renuncia del Vice Presidente Ra√∫l Sendic üò±&lt;/p&gt;

&lt;p&gt;Para senadores:&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/post/de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/2018-04-08-de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/unnamed-chunk-7-1.png&#34; style=&#34;margin: auto;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Para las sesiones de Senadores no se observa un comportamiento similar al de las de Diputados ü§∑üèΩ
‚ôÇÔ∏è&lt;/p&gt;

&lt;h1 id=&#34;sentimiento-en-las-distintas-sesiones&#34;&gt;Sentimiento en las distintas sesiones&lt;/h1&gt;

&lt;p&gt;Me voy a enfocar en las sesiones con sentimientos m√°s extremos. Para eso agrupo por &lt;code&gt;fecha_sesion&lt;/code&gt;, que es una variable que tiene la fecha de la sesi√≥n junto con el n√∫mero de la sesi√≥n. Es el identificador √∫nico de cada sesi√≥n.&lt;/p&gt;

&lt;p&gt;Para Diputados:
Las sesiones con sentimientos m√°s positivos son las que aparecen a continuaci√≥n.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(kableExtra)
knitr::kable(
  sesiones_positivas_diputados &amp;lt;- tidy_diputados  %&amp;gt;%
    inner_join(lexicon, by = c(&amp;quot;word&amp;quot; = &amp;quot;palabra&amp;quot;)) %&amp;gt;%
    group_by(fecha_sesion) %&amp;gt;% 
    count(sentimiento) %&amp;gt;%
    ungroup %&amp;gt;% 
    spread(sentimiento, n, fill = 0) %&amp;gt;%
    mutate(sentimiento = pos - neg) %&amp;gt;% 
    arrange(desc(sentimiento)) %&amp;gt;% 
    top_n(2, sentimiento), 
  format = &amp;quot;html&amp;quot;) %&amp;gt;%
  kable_styling(full_width = F)
&lt;/code&gt;&lt;/pre&gt;

&lt;table class=&#34;table&#34; style=&#34;width: auto !important; margin-left: auto; margin-right: auto;&#34;&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha_sesion &lt;/th&gt;
   &lt;th style=&#34;text-align:right;&#34;&gt; neg &lt;/th&gt;
   &lt;th style=&#34;text-align:right;&#34;&gt; pos &lt;/th&gt;
   &lt;th style=&#34;text-align:right;&#34;&gt; sentimiento &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-06_2 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 158 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 379 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 221 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-12-20_1 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 336 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 506 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 170 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Y las que tienen sentimiento m√°s negativo las siguientes.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;knitr::kable(
  sesiones_negativas_diputados &amp;lt;- tidy_diputados  %&amp;gt;%
    inner_join(lexicon, by = c(&amp;quot;word&amp;quot; = &amp;quot;palabra&amp;quot;)) %&amp;gt;%
    group_by(fecha_sesion) %&amp;gt;% 
    count(sentimiento) %&amp;gt;%
    ungroup %&amp;gt;% 
    spread(sentimiento, n, fill = 0) %&amp;gt;%
    mutate(sentimiento = pos - neg) %&amp;gt;% 
    arrange(sentimiento) %&amp;gt;% 
    top_n(-2, sentimiento),
  format = &amp;quot;html&amp;quot;) %&amp;gt;%
  kable_styling(full_width = F)
&lt;/code&gt;&lt;/pre&gt;

&lt;table class=&#34;table&#34; style=&#34;width: auto !important; margin-left: auto; margin-right: auto;&#34;&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha_sesion &lt;/th&gt;
   &lt;th style=&#34;text-align:right;&#34;&gt; neg &lt;/th&gt;
   &lt;th style=&#34;text-align:right;&#34;&gt; pos &lt;/th&gt;
   &lt;th style=&#34;text-align:right;&#34;&gt; sentimiento &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-05-10_14 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 792 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 360 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; -432 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-02-15_3 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 788 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 484 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; -304 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Para Senadores:
Las sesiones con sentimientos m√°s positivos son las que aparecen a continuaci√≥n.&lt;/p&gt;

&lt;table class=&#34;table&#34; style=&#34;width: auto !important; margin-left: auto; margin-right: auto;&#34;&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha_sesion &lt;/th&gt;
   &lt;th style=&#34;text-align:right;&#34;&gt; neg &lt;/th&gt;
   &lt;th style=&#34;text-align:right;&#34;&gt; pos &lt;/th&gt;
   &lt;th style=&#34;text-align:right;&#34;&gt; sentimiento &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-05-16_15 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 52 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 158 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 106 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-11-28_44 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 243 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 321 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 78 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Y las que tienen sentimiento m√°s negativo las siguientes.&lt;/p&gt;

&lt;table class=&#34;table&#34; style=&#34;width: auto !important; margin-left: auto; margin-right: auto;&#34;&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha_sesion &lt;/th&gt;
   &lt;th style=&#34;text-align:right;&#34;&gt; neg &lt;/th&gt;
   &lt;th style=&#34;text-align:right;&#34;&gt; pos &lt;/th&gt;
   &lt;th style=&#34;text-align:right;&#34;&gt; sentimiento &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-09-18_32 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 598 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 364 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; -234 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-06-07_18 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 458 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; 242 &lt;/td&gt;
   &lt;td style=&#34;text-align:right;&#34;&gt; -216 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&#34;de-qu√©-se-habl√≥-en-las-sesiones-m√°s-negativas&#34;&gt;De qu√© se habl√≥ en las sesiones m√°s negativas?&lt;/h1&gt;

&lt;p&gt;Una de las formas de averiguar √©sto es calculando el &lt;a href=&#34;https://en.wikipedia.org/wiki/Tf%E2%80%93idf&#34;&gt;tf-idf&lt;/a&gt;. La explicaci√≥n a continuaci√≥n es una traducci√≥n casi literal de la explicaci√≥n en ingl√©s del libro &lt;a href=&#34;https://www.tidytextmining.com/tfidf.html&#34;&gt;&amp;ldquo;Text mining with R: a tidy approach&amp;rdquo;&lt;/a&gt;, de &lt;a href=&#34;https://twitter.com/juliasilge&#34;&gt;Julia Silge&lt;/a&gt; y &lt;a href=&#34;https://twitter.com/drob&#34;&gt;David Robinson&lt;/a&gt;, libro que recomiendo.&lt;/p&gt;

&lt;p&gt;Una medida de qu√© tan importante es una palabra en una sesi√≥n parlamentaria es el &lt;em&gt;term frequency (tf)&lt;/em&gt; (frecuencia del t√©rmino), que mide &lt;strong&gt;qu√© tan frecuentemente aparece una palabra en la sesi√≥n&lt;/strong&gt;. Sin embargo, hay palabras que se pueden repetir mucho pero no ser importantes, como las &lt;em&gt;stopwords&lt;/em&gt; que mencion√°bamos anteriormente, las palabras &amp;ldquo;protocolares&amp;rdquo; que en cada sesi√≥n se repiten y los nombres de los legisladores. Podr√≠amos eliminarlas como hicimos antes, pero podr√≠a ser que alguna de ellas fuera m√°s importante en algunas sesiones que en otras, por ejemplo, si un legislador tiene mayor protagonismo en una sesi√≥n por alguna raz√≥n.&lt;/p&gt;

&lt;p&gt;Otro enfoque entonces es mirar el &lt;em&gt;inverse document frequency (idf)&lt;/em&gt; de cada palabra (el inverso de la frecuencia del documento), que &lt;strong&gt;reduce el peso a las palabras com√∫nmente usadas en el total de las sesiones&lt;/strong&gt; y aumenta el de las que no son muy usadas. Combinando esta medida con el &lt;em&gt;term frquency&lt;/em&gt;, calculamos el &lt;em&gt;tf-idf&lt;/em&gt; de una palabra (multiplicando ambas medidas): la frecuencia del t√©rmino, ajustada por qu√© tan raramente es usada. Con el estad√≠stico &lt;em&gt;tf-idf&lt;/em&gt; intento medir qu√© tan importante es una palabra para una sesi√≥n, en el conjunto de sesiones que estoy analizando.&lt;/p&gt;

&lt;p&gt;Calculo el tf-idf de las palabras para cada &lt;code&gt;fecha_sesion&lt;/code&gt;, usando la funci√≥n &lt;code&gt;tidytext::bind_tf_idf()&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Para Diputados:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;sesion_diputados_words &amp;lt;- diputados %&amp;gt;%
  unnest_tokens(word, pdf) %&amp;gt;%
  count(fecha, sesion, fecha_sesion, word, sort = TRUE) %&amp;gt;%
  ungroup()

diputados_words &amp;lt;- sesion_diputados_words %&amp;gt;% 
  group_by(fecha_sesion) %&amp;gt;% 
  summarize(total = sum(n))

sesion_diputados_tfidf &amp;lt;- left_join(sesion_diputados_words, diputados_words) %&amp;gt;%
  bind_tf_idf(word, fecha_sesion, n) 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ac√° tengo todos los tf-idf calculados para todas las sesiones. Filtrando s√≥lo las sesiones m√°s negativas, esto es lo que encuentro.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;sesion_diputados_tfidf_neg &amp;lt;- sesion_diputados_tfidf %&amp;gt;% 
  filter(fecha_sesion %in% sesiones_negativas_diputados$fecha_sesion)

sesion_diputados_tfidf_neg %&amp;gt;%
  arrange(desc(tf_idf)) %&amp;gt;%
  mutate(word = factor(word, levels = rev(unique(word)))) %&amp;gt;% 
  group_by(fecha_sesion) %&amp;gt;% 
  top_n(15, tf_idf) %&amp;gt;% 
  ungroup %&amp;gt;%
  ggplot(aes(word, tf_idf, fill = fecha_sesion)) +
  geom_col(show.legend = FALSE) +
  labs(x = NULL, y = &amp;quot;tf-idf&amp;quot;) +
  scale_fill_viridis(discrete = TRUE, option=&amp;quot;C&amp;quot;) +
  facet_wrap(~fecha_sesion, ncol = 2,  scales = &amp;quot;free&amp;quot;) +
  ggtitle(&amp;quot;tf-idf sesiones de Diputados m√°s negativas&amp;quot;) +
  coord_flip() +
  theme_minimal() 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;/post/de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/2018-04-08-de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/unnamed-chunk-13-1.png&#34; style=&#34;margin: auto;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Las dos sesiones m√°s negativas de Diputados fueron dos interpelaciones: la interpelaci√≥n al Ministro del Interior Eduardo Bonomi que comentaba antes, y &lt;a href=&#34;https://parlamento.gub.uy/noticiasyeventos/noticias/node/87146&#34;&gt;la interpelaci√≥n al canciller Nin Novoa por la posici√≥n a adoptar ante la crisis venezolana&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Para Senadores:&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/post/de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/2018-04-08-de-qu√©-se-habl√≥-en-el-parlamento-uruguayo-desde-2017/unnamed-chunk-14-1.png&#34; style=&#34;margin: auto;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Las sesiones m√°s negativas de los Senadores son:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;7 de junio de 2017: se vot√≥ la &lt;a href=&#34;https://parlamento.gub.uy/noticiasyeventos/noticias/node/87300&#34;&gt;derogaci√≥n de un art√≠culo del C√≥digo Penal referido al Abuso de Funciones en casos no previstos especialmente por la ley&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;18 de setiembre de 2017: se discuti√≥ el proyecto de ley para aprobar la Rendici√≥n de Cuentas y Balance de
Ejecuci√≥n Presupuestal correspondiente al ejercicio 2016.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Pod√©s &lt;a href=&#34;/2017/05/tf-idf-de-todas-las-sesiones-parlamentarias-analizadas/&#34;&gt;ver ac√° el top 15 de las palabras con mayor tf-idf&lt;/a&gt; de todas las sesiones de ambas C√°maras.&lt;/p&gt;

&lt;h1 id=&#34;fin&#34;&gt;Fin!&lt;/h1&gt;

&lt;p&gt;Hay muchas m√°s cosas que se pueden analizar, √©stas fueron las que m√°s me interesaron y por eso las comparto. &lt;a href=&#34;https://github.com/d4tagirl/uruguayan_parliamentary_session_diary&#34;&gt;El an√°lisis completo est√° en GitHub&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Si quer√©s analizar las sesiones fuera de R, o prefer√≠s ahorrarte el paso de hacer scraping, &lt;a href=&#34;https://github.com/d4tagirl/uruguayan_parliamentary_session_diary/blob/master/data/diputados.csv&#34;&gt;ac√° ten√©s las sesiones de Diputados en formato csv&lt;/a&gt;, y &lt;a href=&#34;https://github.com/d4tagirl/uruguayan_parliamentary_session_diary/blob/master/data/senadores.csv&#34;&gt;ac√° las sesiones de Senadores en formato csv&lt;/a&gt; para hacer tus an√°lisis! (Gracias &lt;a href=&#34;https://twitter.com/rolaguna&#34;&gt;Rodrigo&lt;/a&gt; por la sugerencia!)&lt;/p&gt;

&lt;p&gt;Bienvenidas todas las sugerencias y comentarios!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Scrapeando las Sesiones Parlamentarias de Uruguay</title>
      <link>/2018/04/scrapeando-las-sesiones-parlamentarias-de-uruguay/</link>
      <pubDate>Tue, 03 Apr 2018 17:11:29 +0000</pubDate>
      
      <guid>/2018/04/scrapeando-las-sesiones-parlamentarias-de-uruguay/</guid>
      <description>

&lt;p&gt;En Uruguay venimos avanzando con las iniciativas de datos abiertos, pero a√∫n queda mucho camino por recorrer. Algunas de las dificultades para analizar datos abiertos son:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Que no siempre no es f√°cil acceder a ellos de forma sistem√°tica:
por ejemplo porque no est√°n todos juntos en un archivo comprimido para descargarlos, o no existe una API para acceder a la informaci√≥n,&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Que est√°n en formato pdf del que no es tan f√°cil extraer informaci√≥n como de un archivo txt o csv, por nombrar algunos formatos.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;En particular hay dos problemas que quiero resolver:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Descargar los archivos en formato pdf de las Sesiones Parlamentarias de Diputados y Senadores de forma sistem√°tica, haciendo &lt;a href=&#34;https://es.wikipedia.org/wiki/Web_scraping&#34;&gt;lo que se conoce como &lt;em&gt;web scraping&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Extraer el texto contenido en los archivos en formato pdf.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;En este art√≠culo muestro c√≥mo se pueden sortear ambas dificultades, usando los paquetes &lt;a href=&#34;https://github.com/tidyverse/rvest&#34;&gt;rvest&lt;/a&gt; para explorar la web y descargar los Diarios de Sesiones, y &lt;a href=&#34;https://github.com/ropensci/pdftools&#34;&gt;pdftools&lt;/a&gt; para extraer el contenido de los archivos en formato pdf.&lt;/p&gt;

&lt;h1 id=&#34;est√°-permitido-que-un-robot-se-comunique-con-estas-p√°ginas&#34;&gt;Est√° permitido que un robot se comunique con estas p√°ginas?&lt;/h1&gt;

&lt;p&gt;Si bien se trata de datos abiertos, hay ciertas normas &lt;em&gt;de etiqueta&lt;/em&gt; que es recomendable seguir. Respetar las reglas que establecieron los que administran el sitio acerca de c√≥mo quieren que la gente lo use es una de ellas. Puede ser que s√≥lo quieran que se navegue &lt;em&gt;a mano&lt;/em&gt;, entonces no deber√≠a intentar acceder de la forma en que estoy planeando.&lt;/p&gt;

&lt;p&gt;Para ver si la secci√≥n del sitio web que quiero navegar permite ser accedida por un &lt;em&gt;robot&lt;/em&gt; (que es lo que pretendo construir! ü§ñ), examino &lt;a href=&#34;https://en.wikipedia.org/wiki/Robots_exclusion_standard&#34;&gt;el archivo &lt;em&gt;robots.txt&lt;/em&gt;&lt;/a&gt;, donde se establece para cada secci√≥n del sitio si este uso es adecuado. Desde R se puede hacer f√°cilmente usando &lt;a href=&#34;https://github.com/ropensci/robotstxt&#34;&gt;el parquete robotstxt&lt;/a&gt; de &lt;a href=&#34;https://ropensci.org/&#34;&gt;rOpenSci&lt;/a&gt;, que &lt;a href=&#34;https://masalmon.eu/2017/10/02/guardian-experience/&#34;&gt;Ma√´lle mencion√≥ en su post donde scrapea datos de &lt;em&gt;The Guardian&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Este es todo el archivo &lt;em&gt;robots.txt&lt;/em&gt; del &lt;a href=&#34;https://parlamento.gub.uy&#34;&gt;sitio web del Parlamento&lt;/a&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;robotstxt::get_robotstxt(&amp;quot;https://parlamento.gub.uy&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## #
## # robots.txt
## #
## # This file is to prevent the crawling and indexing of certain parts
## # of your site by web crawlers and spiders run by sites like Yahoo!
## # and Google. By telling these &amp;quot;robots&amp;quot; where not to go on your site,
## # you save bandwidth and server resources.
## #
## # This file will be ignored unless it is at the root of your host:
## # Used:    http://example.com/robots.txt
## # Ignored: http://example.com/site/robots.txt
## #
## # For more information about the robots.txt standard, see:
## # http://www.robotstxt.org/robotstxt.html
## 
## User-agent: *
## Crawl-delay: 10
## # CSS, JS, Images
## Allow: /misc/*.css$
## Allow: /misc/*.css?
## Allow: /misc/*.js$
## Allow: /misc/*.js?
## Allow: /misc/*.gif
## Allow: /misc/*.jpg
## Allow: /misc/*.jpeg
## Allow: /misc/*.png
## Allow: /modules/*.css$
## Allow: /modules/*.css?
## Allow: /modules/*.js$
## Allow: /modules/*.js?
## Allow: /modules/*.gif
## Allow: /modules/*.jpg
## Allow: /modules/*.jpeg
## Allow: /modules/*.png
## Allow: /profiles/*.css$
## Allow: /profiles/*.css?
## Allow: /profiles/*.js$
## Allow: /profiles/*.js?
## Allow: /profiles/*.gif
## Allow: /profiles/*.jpg
## Allow: /profiles/*.jpeg
## Allow: /profiles/*.png
## Allow: /themes/*.css$
## Allow: /themes/*.css?
## Allow: /themes/*.js$
## Allow: /themes/*.js?
## Allow: /themes/*.gif
## Allow: /themes/*.jpg
## Allow: /themes/*.jpeg
## Allow: /themes/*.png
## # Directories
## Disallow: /includes/
## Disallow: /misc/
## Disallow: /modules/
## Disallow: /profiles/
## Disallow: /scripts/
## Disallow: /themes/
## # Files
## Disallow: /CHANGELOG.txt
## Disallow: /cron.php
## Disallow: /INSTALL.mysql.txt
## Disallow: /INSTALL.pgsql.txt
## Disallow: /INSTALL.sqlite.txt
## Disallow: /install.php
## Disallow: /INSTALL.txt
## Disallow: /LICENSE.txt
## Disallow: /MAINTAINERS.txt
## Disallow: /update.php
## Disallow: /UPGRADE.txt
## Disallow: /xmlrpc.php
## # Paths (clean URLs)
## Disallow: /admin/
## Disallow: /comment/reply/
## Disallow: /filter/tips/
## Disallow: /node/add/
## Disallow: /search/
## Disallow: /user/register/
## Disallow: /user/password/
## Disallow: /user/login/
## Disallow: /user/logout/
## # Paths (no clean URLs)
## Disallow: /?q=admin/
## Disallow: /?q=comment/reply/
## Disallow: /?q=filter/tips/
## Disallow: /?q=node/add/
## Disallow: /?q=search/
## Disallow: /?q=user/password/
## Disallow: /?q=user/register/
## Disallow: /?q=user/login/
## Disallow: /?q=user/logout/
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/a/40186203/7248543&#34;&gt;Lo que no aparece como &lt;em&gt;&amp;ldquo;Disallow&amp;rdquo;&lt;/em&gt; es permitido por defecto&lt;/a&gt;, y la url a la que quiero acceder usando un robot es &lt;a href=&#34;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion&#34;&gt;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion&lt;/a&gt;. No dice en ning√∫n lugar del documento &lt;code&gt;Disallow: /documentosyleyes/&lt;/code&gt;, entonces est√° permitido!&lt;/p&gt;

&lt;p&gt;Pero por las dudas, chequeo esa url en particular:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;robotstxt::paths_allowed(&amp;quot;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## [1] TRUE
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Tengo luz verde para scrapear la web üôå.&lt;/p&gt;

&lt;h1 id=&#34;url-de-las-p√°ginas-que-quiero-scrapear&#34;&gt;Url de las p√°ginas que quiero &lt;em&gt;scrapear&lt;/em&gt;&lt;/h1&gt;

&lt;p&gt;Mi intenci√≥n es descargar las sesiones de Diputados y Senadores desde el 1¬∫/1/2017 hasta el 31/3/2018. Al incorporar estos filtros manualmente en la p√°gina &lt;a href=&#34;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion&#34;&gt;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion&lt;/a&gt;, la url se va modificando para incorporar esta informaci√≥n. Eso hace las cosas algo menos complicadas para mi, porque una vez que me doy cuenta c√≥mo se comporta la url con esos filtros, puedo generar la url nueva y directamente acceder a ella. As√≠ construyo la nueva url que se compone de la url original, algo de texto adicional y los filtros de fechas, de la siguiente forma:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;date_init &amp;lt;- &amp;quot;01-01-2017&amp;quot;
date_end  &amp;lt;- &amp;quot;31-03-2018&amp;quot;

url_diputados &amp;lt;- paste0(&amp;quot;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion?Cpo_Codigo_2=D&amp;amp;Lgl_Nro=48&amp;amp;DS_Fecha%5Bmin%5D%5Bdate%5D=&amp;quot;,
                        date_init,
                        &amp;quot;&amp;amp;DS_Fecha%5Bmax%5D%5Bdate%5D=&amp;quot;,
                        date_end,
                        &amp;quot;&amp;amp;Ssn_Nro=&amp;amp;TS_Diario=&amp;amp;tipoBusqueda=T&amp;amp;Texto=&amp;quot;)
url_diputados
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion?Cpo_Codigo_2=D&amp;amp;Lgl_Nro=48&amp;amp;DS_Fecha%5Bmin%5D%5Bdate%5D=01-01-2017&amp;amp;DS_Fecha%5Bmax%5D%5Bdate%5D=31-03-2018&amp;amp;Ssn_Nro=&amp;amp;TS_Diario=&amp;amp;tipoBusqueda=T&amp;amp;Texto=&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;url_senadores &amp;lt;- paste0(&amp;quot;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion?Cpo_Codigo_2=S&amp;amp;Lgl_Nro=48&amp;amp;DS_Fecha%5Bmin%5D%5Bdate%5D=&amp;quot;,
                        date_init,
                        &amp;quot;&amp;amp;DS_Fecha%5Bmax%5D%5Bdate%5D=&amp;quot;,
                        date_end,
                        &amp;quot;&amp;amp;Ssn_Nro=&amp;amp;TS_Diario=&amp;amp;tipoBusqueda=T&amp;amp;Texto=&amp;quot;)

url_senadores
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion?Cpo_Codigo_2=S&amp;amp;Lgl_Nro=48&amp;amp;DS_Fecha%5Bmin%5D%5Bdate%5D=01-01-2017&amp;amp;DS_Fecha%5Bmax%5D%5Bdate%5D=31-03-2018&amp;amp;Ssn_Nro=&amp;amp;TS_Diario=&amp;amp;tipoBusqueda=T&amp;amp;Texto=&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;y-ahora-c√≥mo-selecciono-el-contenido-de-la-p√°gina&#34;&gt;Y ahora? C√≥mo selecciono el contenido de la p√°gina?&lt;/h1&gt;

&lt;p&gt;Las p√°ginas web son archivos html que el navegador interpreta y los transforma en lo que nosotros vemos. No voy a entrar en muchos detalles de c√≥mo interpretar un archivo html (porque reci√©n estoy aprendiendo!), pero ac√° describo la  forma m√°s intuitiva que encontr√© para seleccionar el contenido del html al que quiero acceder.&lt;/p&gt;

&lt;p&gt;Como se muestra en la animaci√≥n a continuaci√≥n, usando el &lt;a href=&#34;https://selectorgadget.com/&#34;&gt;Selector Gadget&lt;/a&gt; (que tiene una extensi√≥n para Google Chrome muy conveniente) me paro con el mouse sobre uno de los links a los pdfs y hago click. Ah√≠ queda pintada toda la columna, porque pinta todos los elementos que son de la misma &lt;em&gt;clase&lt;/em&gt; (no nos preocupemos de qu√© es una &lt;em&gt;clase&lt;/em&gt; ahora). Lo importante es que necesito &lt;em&gt;el nombre de la clase&lt;/em&gt; para lo que viene a continuaci√≥n, entonces copio el texto que aparece en el recuadro (en este caso es &lt;code&gt;.views-field-DS-File-IMG&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/post/scrapeando-las-sesiones-parlamentarias-de-uruguay/2018-04-03-scrapeando-las-sesiones-parlamentarias-de-uruguay/selector_gadget.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h1 id=&#34;web-scraping&#34;&gt;Web scraping!&lt;/h1&gt;

&lt;h2 id=&#34;extraigo-los-pdfs&#34;&gt;Extraigo los pdfs&lt;/h2&gt;

&lt;p&gt;Ahora es que empiezo a usar el paquete &lt;a href=&#34;https://github.com/tidyverse/rvest&#34;&gt;rvest&lt;/a&gt;. Defino una funci√≥n que descarga los pdfs y los guarda en un dataframe, haciendo algunas transformaciones. Para explicar lo que hace la funci√≥n voy a ignorar que como las sesiones son muchas, las muestra en dos p√°ginas separadas. Es verdad que podr√≠a haber puesto un poco m√°s de esfuerzo en hacer esta funci√≥n generalizable a &lt;em&gt;n&lt;/em&gt; p√°ginas, pero como sab√≠a que ten√≠a s√≥lo 2, lo dej√© as√≠ üòá&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(dplyr)
library(rvest)
library(purrr)
library(tibble)
library(pdftools)

extract_pdf &amp;lt;- function(url, pag = 1) {
  
  if (pag == 2) {
    url &amp;lt;- url %&amp;gt;%
      read_html() %&amp;gt;%
      html_nodes(&amp;quot;.pager-item a&amp;quot;) %&amp;gt;%
      html_attr(&amp;quot;href&amp;quot;) %&amp;gt;%
      map(~ paste0(&amp;quot;https://parlamento.gub.uy&amp;quot;, .)) %&amp;gt;%
      unlist()
    }
  
  pdfs &amp;lt;- url %&amp;gt;%
    read_html() %&amp;gt;%
    html_nodes(&amp;quot;.views-field-DS-File-IMG a&amp;quot;) %&amp;gt;%   # seleccionar clase
    html_attr(&amp;quot;href&amp;quot;) %&amp;gt;%
    map(~ paste0(&amp;quot;https://parlamento.gub.uy&amp;quot;, .)) %&amp;gt;%
    map(~ paste0(pdf_text(.), collapse = &#39; &#39;)) %&amp;gt;%
    map(~ stri_trans_general(tolower(.), id = &amp;quot;latin-ascii&amp;quot;)) %&amp;gt;%
    map(~ stri_replace_all(., replacement = &amp;quot;&amp;quot;, regex = &amp;quot;\\\n&amp;quot;)) %&amp;gt;% 
    map_df(function(pdf) {tibble(pdf)})
  
  return(pdfs)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;La primera parte de la funci√≥n es la que voy a ignorar, donde lo que hago es modificar la url para indicar que quiero ir a la segunda p√°gina (se puede aplicar la misma l√≥gica que la que voy a usar a continuaci√≥n para interpretar esta parte del c√≥digo).&lt;/p&gt;

&lt;p&gt;Lo interesante pasa cuando empiezo a procesar la url: &lt;code&gt;read_html()&lt;/code&gt; &amp;ldquo;lee&amp;rdquo; el contenido de la p√°gina, para que pueda buscar lo que me interesa. Mi objetivo es encontrar todos los archivos pdf (por eso me interesaba conocer &lt;em&gt;el nombre de la clase&lt;/em&gt; de esos elementos, que descubr√≠ antes). Con &lt;code&gt;html_nodes()&lt;/code&gt; voy extrayendo los &lt;em&gt;nodos&lt;/em&gt; (tampoco nos preocupemos ahora por saber qu√© son exactamente), y en este caso el &lt;em&gt;nodo&lt;/em&gt; que me interesa es &lt;code&gt;.views-field-DS-File-IMG a&lt;/code&gt;:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;tiene un punto adelante para indicar que se trata de elementos de una clase, seguido del nombre de la clase &lt;code&gt;views-field-DS-File-IMG&lt;/code&gt; (lo que copiamos con el &lt;em&gt;Selector Gadget&lt;/em&gt;),&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;a&lt;/code&gt; es la etiqueta que html usa para definir elementos que son un hiperv√≠nculo.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Ahora puedo seleccionar el atributo &lt;code&gt;href&lt;/code&gt;, que es el link al pdf, con la funci√≥n &lt;code&gt;html_attr()&lt;/code&gt;. Ac√° hay que tener cuidado porque la ruta es relativa (es decir que falta poner &amp;ldquo;&lt;a href=&#34;https://parlamento.gub.uy&amp;quot;&#34;&gt;https://parlamento.gub.uy&amp;quot;&lt;/a&gt; antes para tener la ruta completa).&lt;/p&gt;

&lt;p&gt;Al aplicar la funci√≥n hasta ac√°, lo que tengo es una lista con una url por cada pdf que aparece en la p√°gina. Por eso luego uso la funci√≥n &lt;code&gt;purrr::map()&lt;/code&gt; para aplicar a cada elemento de la lista (cada link a los pdfs), una funci√≥n. Las transformaciones que aplico a cada elemento de la lista son, en forma sucesiva, las siguientes:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;paste0(&amp;quot;https://parlamento.gub.uy&amp;quot;, .)&lt;/code&gt; completo la ruta absoluta, pegando &amp;ldquo;&lt;a href=&#34;https://parlamento.gub.uy&amp;quot;&#34;&gt;https://parlamento.gub.uy&amp;quot;&lt;/a&gt; adelante del link relativo,&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;paste0(pdf_text(.), collapse = &#39; &#39;)&lt;/code&gt; usando el paquete &lt;code&gt;pdftools&lt;/code&gt; extraigo la informaci√≥n del pdf con la funci√≥n &lt;code&gt;pdf_text()&lt;/code&gt; y colapso todas las p√°ginas en un mismo string,&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;stri_trans_general(tolower(.), id = &amp;quot;latin-ascii&amp;quot;)&lt;/code&gt; saco los caracteres especiales y dejo todo en min√∫scula,&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;stri_replace_all(., replacement = &amp;quot;&amp;quot;, regex = &amp;quot;\\\n&amp;quot;)&lt;/code&gt; elimino los saltos de l√≠nea,&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;tibble(pdf)&lt;/code&gt; transformo la lista en un dataframe.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Entonces ahora extraigo los pdfs de las dos p√°ginas y los junto en un √∫nico dataframe (voy a mostrar el proceso para Diputados, pero es an√°logo para Senadores).&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;pdf_diputados_pag1 &amp;lt;- extract_pdf(url_diputados, pag = 1)
pdf_diputados_pag2 &amp;lt;- extract_pdf(url_diputados, pag = 2)

pdf_diputados &amp;lt;- bind_rows(pdf_diputados_pag1, pdf_diputados_pag2)

library(knitr)
library(kableExtra)

knitr::kable(head(pdf_diputados) %&amp;gt;%
               select(pdf) %&amp;gt;% 
               mutate(pdf = substr(pdf, start=1, stop=500)),
             format = &amp;quot;html&amp;quot;) 
&lt;/code&gt;&lt;/pre&gt;

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; pdf &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4151                                                          montevideo, miercoles 14 de marzo de 2018
                  republica oriental del uruguay
                        diario de sesiones
                camara de representantes
                               5¬™ sesion (extraordinaria)
                                      preside el senor representante
                                               jorge gandini
                                                 (presidente) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4148                                                              montevideo, martes 6 de marzo de 2018
                  republica oriental del uruguay
                        diario de sesiones
                camara de representantes
                                                2¬™ sesion
                                  presiden los senores representantes
                                                jorge gandini
                                                  (presidente) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4147                                                              montevideo, jueves 1¬∞ de marzo de 2018
                  republica oriental del uruguay
                        diario de sesiones
                camara de representantes
                                               1¬™ sesion
                                      preside el senor representante
                                               jorge gandini
                                                 (presidente) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4146                                                             montevideo, jueves 8 de febrero de 2018
                  republica oriental del uruguay
                         diario de sesiones
                camara de representantes
                               3¬™ sesion (extraordinaria)
                                  presiden los senores representantes
                                           prof. jose carlos mahia
                                                   (preside &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4145                                                  montevideo, miercoles 7 de febrero de 2018
                 republica oriental del uruguay
                    diario de sesiones
                camara de representantes
                       2¬™ sesion (extraordinaria)
                             preside el senor representante
                                  prof. jose carlos mahia
                                          (presidente)
                             actuan en secret &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4144                                                         montevideo, miercoles 20 de diciembre de 2017
                  republica oriental del uruguay
                         diario de sesiones
                camara de representantes
                               1¬™ sesion (extraordinaria)
                                  presiden los senores representantes
                                           prof. jose carlos mahia
                                                   (presi &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;advertencia&#34;&gt;‚ö†Ô∏è Advertencia ‚ö†Ô∏è&lt;/h3&gt;

&lt;p&gt;La funci√≥n &lt;code&gt;pdftools::read_pdf()&lt;/code&gt; lee los renglones de izquierda a derecha. En los Diarios de Sesiones hay algunas p√°ginas que se organizan con texto en dos columnas, entonces hay renglones que, le√≠dos de esa forma, quedan incoherentes. Esto hay que tenerlo en cuenta para ver si el tipo de an√°lisis que quiero hacer tiene sentido o no. Por ejemplo, si lo que quiero es analizar &lt;a href=&#34;https://es.wikipedia.org/wiki/N-grama&#34;&gt;&lt;em&gt;n-gramas&lt;/em&gt;&lt;/a&gt; donde el orden de las palabras es importante, voy a tener problemas porque estar√≠a considerando palabras de distintas columnas de texto, como si vinieran una a continuaci√≥n de la otra. Para analizar sentimiento con &lt;a href=&#34;https://es.wikipedia.org/wiki/Modelo_bolsa_de_palabras&#34;&gt;&lt;em&gt;bolsa de palabras (bag of words)&lt;/em&gt;&lt;/a&gt; no hay problema, porque el orden de las palabras no es relevante.&lt;/p&gt;

&lt;h2 id=&#34;extraigo-fecha-y-n√∫mero-de-sesi√≥n&#34;&gt;Extraigo fecha y n√∫mero de sesi√≥n&lt;/h2&gt;

&lt;p&gt;Hago una segunda funci√≥n para extraer otros la fecha y el n√∫mero de la sesi√≥n, porque se puede dar el caso de tener m√°s de una sesi√≥n en la misma fecha.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;extract_metadata &amp;lt;- function(url, info, pag = 1){
  if (info == &amp;quot;fecha&amp;quot;) nodes = &amp;quot;td.views-field-DS-Fecha&amp;quot;
  if (info == &amp;quot;sesion&amp;quot;) nodes = &amp;quot;td.views-field-Ssn-Nro&amp;quot;
  if (pag == 2){
    url &amp;lt;- url %&amp;gt;%
      read_html() %&amp;gt;%
      html_nodes(&amp;quot;.pager-item a&amp;quot;) %&amp;gt;%
      html_attr(&amp;quot;href&amp;quot;) %&amp;gt;%
      map(~ paste0(&amp;quot;https://parlamento.gub.uy&amp;quot;, .)) %&amp;gt;%
      unlist() 
    }
  
  url %&amp;gt;% 
    read_html() %&amp;gt;% 
    html_nodes(nodes) %&amp;gt;% 
    html_text() %&amp;gt;% 
    map(~str_extract(., &amp;quot;[0-9\\-]+&amp;quot;)) %&amp;gt;%  # esta expresi√≥n regular matchea tanto la fecha como el n√∫mero de sesi√≥n
    unlist()
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Extraigo la fecha y la sesi√≥n.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# extraigo fechas
pdf_fechas_diputados_pag1 &amp;lt;- extract_metadata(url_diputados, info = &amp;quot;fecha&amp;quot;, pag = 1)
pdf_fechas_diputados_pag2 &amp;lt;- extract_metadata(url_diputados, info = &amp;quot;fecha&amp;quot;, pag = 2)

# junto todos las fechas y las convierto en un df
pdf_fechas_diputados &amp;lt;- c(pdf_fechas_diputados_pag1, pdf_fechas_diputados_pag2) %&amp;gt;% 
  tbl_df() %&amp;gt;% 
  transmute(fecha = as.Date(value, &amp;quot;%d-%m-%Y&amp;quot;))

# extraigo sesiones
pdf_sesion_diputados_pag1 &amp;lt;- extract_metadata(url_diputados, info = &amp;quot;sesion&amp;quot;, pag = 1)
pdf_sesion_diputados_pag2 &amp;lt;- extract_metadata(url_diputados, info = &amp;quot;sesion&amp;quot;, pag = 2)

# junto todos las sesiones y las convierto en un df
pdf_sesion_diputados &amp;lt;- c(pdf_sesion_diputados_pag1, pdf_sesion_diputados_pag2) %&amp;gt;% 
  tbl_df() %&amp;gt;% 
  rename(sesion = value)

knitr::kable(head(pdf_sesion_diputados) %&amp;gt;% select(fecha),
             format = &amp;quot;html&amp;quot;) 
&lt;/code&gt;&lt;/pre&gt;

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-14 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-06 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-01 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-08 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-07 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-12-20 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;knitr::kable(head(pdf_sesion_diputados) %&amp;gt;% select(sesion),
             format = &amp;quot;html&amp;quot;) 
&lt;/code&gt;&lt;/pre&gt;

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; sesion &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 3 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
Juntando todo, armo el dataframe de Diputados con la fecha, la sesi√≥n y el texto del pdf.


```r
diputados &lt;- bind_cols(pdf_fechas_diputados, pdf_sesion_diputados, pdf_diputados) %&gt;% 
  unite(&#34;fecha_sesion&#34;, c(fecha, sesion), remove = FALSE) %&gt;%
  distinct() # la primer sesi√≥n de la segunda p√°gina es igual a la √∫ltima sesi√≥n de la primera p√°gina
```

Con este dataframe es con el que voy a trabajar para los Diputados, que tiene 66 sesiones.


```r
knitr::kable(head(diputados) %&gt;% 
               mutate(pdf = substr(pdf, start=1, stop=500)), 
             format = &#34;html&#34;) 
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha_sesion &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; sesion &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; pdf &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-14_5 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-14 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 5 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4151                                                          montevideo, miercoles 14 de marzo de 2018
                  republica oriental del uruguay
                        diario de sesiones
                camara de representantes
                               5¬™ sesion (extraordinaria)
                                      preside el senor representante
                                               jorge gandini
                                                 (presidente) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-06_2 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-06 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4148                                                              montevideo, martes 6 de marzo de 2018
                  republica oriental del uruguay
                        diario de sesiones
                camara de representantes
                                                2¬™ sesion
                                  presiden los senores representantes
                                                jorge gandini
                                                  (presidente) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-01_1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-01 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4147                                                              montevideo, jueves 1¬∞ de marzo de 2018
                  republica oriental del uruguay
                        diario de sesiones
                camara de representantes
                                               1¬™ sesion
                                      preside el senor representante
                                               jorge gandini
                                                 (presidente) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-08_3 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-08 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 3 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4146                                                             montevideo, jueves 8 de febrero de 2018
                  republica oriental del uruguay
                         diario de sesiones
                camara de representantes
                               3¬™ sesion (extraordinaria)
                                  presiden los senores representantes
                                           prof. jose carlos mahia
                                                   (preside &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-07_2 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-07 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4145                                                  montevideo, miercoles 7 de febrero de 2018
                 republica oriental del uruguay
                    diario de sesiones
                camara de representantes
                       2¬™ sesion (extraordinaria)
                             preside el senor representante
                                  prof. jose carlos mahia
                                          (presidente)
                             actuan en secret &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-12-20_1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-12-20 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; numero 4144                                                         montevideo, miercoles 20 de diciembre de 2017
                  republica oriental del uruguay
                         diario de sesiones
                camara de representantes
                               1¬™ sesion (extraordinaria)
                                  presiden los senores representantes
                                           prof. jose carlos mahia
                                                   (presi &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Y con este dataframe es con el que voy a trabajar para los Senadores, que tiene 59 sesiones.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;knitr::kable(head(senadores) %&amp;gt;% 
               mutate(pdf = substr(pdf, start=1, stop=500)), 
             format = &amp;quot;html&amp;quot;) 
&lt;/code&gt;&lt;/pre&gt;

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha_sesion &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; fecha &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; sesion &lt;/th&gt;
   &lt;th style=&#34;text-align:left;&#34;&gt; pdf &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-06_1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-03-06 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 1 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; n.¬∫ 1 - tomo 578                                                                                                      6 de marzo de 2018                                            republica oriental del uruguay                           diario de sesiones                                                                      de la                  camara de senadores                                      cuarto periodo de la xlviii legislatura &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-27_57 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-27 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 57 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; n.¬∫ 57 - tomo 577                                                                                                    27 de febrero de 2018                                            republica oriental del uruguay                            diario de sesiones                                                                       de la                camara de senadores                                       tercer periodo de la xlviii legislatura                                                   57 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-21_56 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-21 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 56 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; n.¬∫ 56 - tomo 577                                                                                                   21 de febrero de 2018                                            republica oriental del uruguay                            diario de sesiones                                                                       de la                camara de senadores                                       tercer periodo de la xlviii legislatura                                                  56.¬™ &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-07_55 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-07 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 55 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; n.¬∫ 55 - tomo 577                                                                                                       7 de febrero de 2018                                            republica oriental del uruguay                           diario de sesiones                                                                      de la                camara de senadores                                       tercer periodo de la xlviii legislatura                                                  55. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-06_54 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2018-02-06 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 54 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; n.¬∫ 54 - tomo 577                                                                                                    6 de febrero de 2018                                            republica oriental del uruguay                           diario de sesiones                                                                      de la                camara de senadores                                       tercer periodo de la xlviii legislatura                                                  54.¬™ s &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-12-27_53 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 2017-12-27 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; 53 &lt;/td&gt;
   &lt;td style=&#34;text-align:left;&#34;&gt; n.¬∫ 53 - tomo 577                                                                                                27 de diciembre de 2017                                            republica oriental del uruguay                           diario de sesiones                                                                      de la                camara de senadores                                       tercer periodo de la xlviii legislatura                                                  53.¬™ se &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&#34;tad√°&#34;&gt;Tad√° üéâ&lt;/h1&gt;

&lt;p&gt;Ahora con los datos en este formato, estoy en condiciones de analizar las sesiones!&lt;/p&gt;

&lt;p&gt;Para m√°s informaci√≥n acerca de c√≥mo trabajar con datos de la web, hay un &lt;a href=&#34;https://www.datacamp.com/community/tutorials/r-web-scraping-rvest&#34;&gt;tutorial de Arvid Kingl en Datacamp en ingl√©s para usar &lt;code&gt;rvest&lt;/code&gt;&lt;/a&gt; y hay un &lt;a href=&#34;https://www.datacamp.com/courses/working-with-web-data-in-r&#34;&gt;curso de Charlotte Wickham y Oliver Keyes, tambi√©n en ingl√©s y en Datacamp,&lt;/a&gt; que habla adem√°s de otras formas de consumir datos de la web, como a trav√©s de APIs.&lt;/p&gt;

&lt;p&gt;Si quer√©s analizar las sesiones fuera de R, o prefer√≠s ahorrarte el paso de hacer scraping, &lt;a href=&#34;https://github.com/d4tagirl/uruguayan_parliamentary_session_diary/blob/master/data/diputados.csv&#34;&gt;ac√° ten√©s las sesiones de Diputados en formato csv&lt;/a&gt;, y &lt;a href=&#34;https://github.com/d4tagirl/uruguayan_parliamentary_session_diary/blob/master/data/senadores.csv&#34;&gt;ac√° las sesiones de Senadores en formato csv&lt;/a&gt; para hacer tus an√°lisis! (Gracias &lt;a href=&#34;https://twitter.com/rolaguna&#34;&gt;Rodrigo&lt;/a&gt; por la sugerencia!)&lt;/p&gt;

&lt;p&gt;Todo lo que us√© en este art√≠culo (y m√°s!) est√° &lt;a href=&#34;https://github.com/d4tagirl/uruguayan_parliamentary_session_diary&#34;&gt;disponible en GitHub&lt;/a&gt;. Espero que haya resultado √∫til! Dejame tus comentarios abajo o &lt;a href=&#34;https://twitter.com/intent/tweet?user_id=114258616&#34;&gt;mencioname en Twitter&lt;/a&gt; üòÉ&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
